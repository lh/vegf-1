# Eylea Time-Based T&T Protocol with Heterogeneity
# Fixed dosing with heterogeneous patient responses based on Seven-UP study
# Uses time-based disease progression model with patient variability

# Metadata
name: "Eylea time based T&T - Heterogeneous"
version: "1.0"
created_date: "2025-01-18"
author: "Clinical Team"
description: "Fixed dosing protocol with time-based disease progression and patient heterogeneity"

# Model type indicator
model_type: "time_based"
transition_model: "fortnightly"
update_interval_days: 14

# Protocol parameters - FIXED dosing (not treat-and-extend)
protocol_type: "fixed"

# Loading dose phase
loading_dose_injections: 3  # Number of initial monthly injections
loading_dose_interval_days: 28  # Monthly (4 weeks) during loading

# Fixed dosing phase (after loading) - bimonthly
min_interval_days: 56  # 8 weeks (2 months)
max_interval_days: 56  # 8 weeks - no extension
extension_days: 0  # No extension - fixed schedule
shortening_days: 0  # No shortening - fixed schedule

# Visit type specification
loading_visit_type: "injection_with_assessment"
maintenance_visit_type: "injection_with_assessment"

# Disease transitions - not used in time-based model but kept for compatibility
disease_transitions:
  NAIVE:
    NAIVE: 0.0
    STABLE: 0.3
    ACTIVE: 0.6
    HIGHLY_ACTIVE: 0.1
  STABLE:
    NAIVE: 0.0
    STABLE: 0.85
    ACTIVE: 0.15
    HIGHLY_ACTIVE: 0.0
  ACTIVE:
    NAIVE: 0.0
    STABLE: 0.4
    ACTIVE: 0.5
    HIGHLY_ACTIVE: 0.1
  HIGHLY_ACTIVE:
    NAIVE: 0.0
    STABLE: 0.1
    ACTIVE: 0.4
    HIGHLY_ACTIVE: 0.5

# Treatment effect multipliers - not used in time-based model
treatment_effect_on_transitions:
  NAIVE:
    STABLE: 2.0
    ACTIVE: 0.5
    HIGHLY_ACTIVE: 0.33
  STABLE:
    STABLE: 1.2
    ACTIVE: 0.8
    HIGHLY_ACTIVE: 0.5
  ACTIVE:
    STABLE: 1.5
    ACTIVE: 0.8
    HIGHLY_ACTIVE: 0.5
  HIGHLY_ACTIVE:
    STABLE: 2.0
    ACTIVE: 1.5
    HIGHLY_ACTIVE: 0.67

# Vision parameters - used by time-based model
vision_change_per_visit:
  NAIVE: -0.5
  STABLE: 0.5
  ACTIVE: -2.0
  HIGHLY_ACTIVE: -4.0
vision_change_std: 2.0

# Baseline vision distribution
baseline_vision:
  distribution: "normal"
  mean: 60.0
  std: 10.0

# Heterogeneity configuration - enables patient variability
heterogeneity:
  enabled: true
  version: '1.0'
  
  # Patient trajectory classes based on Seven-UP study patterns
  trajectory_classes:
    good_responders:
      proportion: 0.25
      description: "Patients who maintain vision near baseline with good treatment response"
      parameters:
        treatment_effect_multiplier:
          distribution: lognormal
          mean: 1.3
          std: 0.2
          comment: "30% better treatment response on average"
        disease_progression_multiplier:
          distribution: lognormal
          mean: 0.7
          std: 0.15
          comment: "30% slower disease progression"
        # Time-based specific: treatment lasts longer
        treatment_duration_multiplier:
          distribution: lognormal
          mean: 1.2
          std: 0.1
          comment: "Treatment effects last 20% longer"
    
    moderate_decliners:
      proportion: 0.40
      description: "Patients with gradual vision decline over time"
      parameters:
        treatment_effect_multiplier:
          distribution: lognormal
          mean: 1.0
          std: 0.3
          comment: "Average treatment response with high variability"
        disease_progression_multiplier:
          distribution: lognormal
          mean: 1.0
          std: 0.3
          comment: "Average disease progression"
        treatment_duration_multiplier:
          distribution: lognormal
          mean: 1.0
          std: 0.15
          comment: "Average treatment duration"
    
    poor_responders:
      proportion: 0.35
      description: "Patients with rapid vision decline despite treatment"
      parameters:
        treatment_effect_multiplier:
          distribution: lognormal
          mean: 0.7
          std: 0.2
          comment: "30% worse treatment response"
        disease_progression_multiplier:
          distribution: lognormal
          mean: 1.5
          std: 0.4
          comment: "50% faster disease progression"
        treatment_duration_multiplier:
          distribution: lognormal
          mean: 0.8
          std: 0.15
          comment: "Treatment effects wear off 20% faster"
  
  # Additional patient-specific parameters
  patient_parameters:
    # Treatment resistance development (tachyphylaxis)
    resistance_rate:
      distribution: beta
      alpha: 2
      beta: 5
      comment: "Rate at which treatment effectiveness decreases over time"
    
    # Maximum achievable vision (ceiling effect)
    max_achievable_va_offset:
      distribution: normal
      mean: 10
      std: 15
      comment: "Added to baseline VA to determine individual ceiling (capped at 85)"
    
    # Individual baseline progression rate variation
    baseline_decline_multiplier:
      distribution: lognormal
      mean: 1.0
      std: 0.3
      comment: "Individual variation in natural disease progression rate"
  
  # Rare catastrophic events that permanently affect vision
  catastrophic_events:
    geographic_atrophy:
      probability_per_month: 0.001
      vision_impact:
        distribution: uniform
        min: -30
        max: -10
      permanent: true
      progression_multiplier: 2.0  # Doubles progression rate after GA
      comment: "Development of geographic atrophy"
    
    subretinal_fibrosis:
      probability_per_month: 0.0005
      vision_impact:
        distribution: normal
        mean: -20
        std: 5
      permanent: true
      max_va_reduction: 20
      treatment_response_multiplier: 0.5  # Halves treatment effectiveness
      comment: "Fibrosis reduces treatment response"
  
  # Validation targets from Seven-UP study
  validation:
    mean_change_7_years: -8.6
    std_7_years: 30
    year2_year7_correlation: 0.97
    proportion_above_70: 0.25
    proportion_below_35: 0.35
    comment: "Target outcomes for model validation against Seven-UP study"
  
  # Debug settings
  debug: true  # Enable to see patient assignments in logs
  debug_output:
    - patient_assignments    # Log trajectory class assignments
    - treatment_responses    # Log individual treatment effects
    - progression_rates      # Log disease progression rates
    - validation_metrics     # Log validation calculations

# Time-based model parameter directory
parameters_directory: "./parameters"