<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulation Modules &mdash; Macular Simulation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Analysis Modules" href="../analysis/index.html" />
    <link rel="prev" title="Macular Degeneration Treatment Simulation Project" href="../PROJECT_OVERVIEW.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Macular Simulation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../PROJECT_OVERVIEW.html">Macular Degeneration Treatment Simulation Project</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulation Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#simulation.base.ProtocolEvent"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.ProtocolEvent.phase_type"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent.phase_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.ProtocolEvent.action"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent.action</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.ProtocolEvent.parameters"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent.parameters</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.ProtocolEvent.result"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent.result</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.ProtocolEvent.__init__"><code class="docutils literal notranslate"><span class="pre">ProtocolEvent.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation.base.SimulationEnvironment"><code class="docutils literal notranslate"><span class="pre">SimulationEnvironment</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.SimulationEnvironment.__init__"><code class="docutils literal notranslate"><span class="pre">SimulationEnvironment.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation.base.Event"><code class="docutils literal notranslate"><span class="pre">Event</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.time"><code class="docutils literal notranslate"><span class="pre">Event.time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.event_type"><code class="docutils literal notranslate"><span class="pre">Event.event_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.patient_id"><code class="docutils literal notranslate"><span class="pre">Event.patient_id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.data"><code class="docutils literal notranslate"><span class="pre">Event.data</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.priority"><code class="docutils literal notranslate"><span class="pre">Event.priority</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.protocol_event"><code class="docutils literal notranslate"><span class="pre">Event.protocol_event</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.phase"><code class="docutils literal notranslate"><span class="pre">Event.phase</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.protocol"><code class="docutils literal notranslate"><span class="pre">Event.protocol</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.create_protocol_event"><code class="docutils literal notranslate"><span class="pre">Event.create_protocol_event()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.get_visit_type"><code class="docutils literal notranslate"><span class="pre">Event.get_visit_type()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.get_required_actions"><code class="docutils literal notranslate"><span class="pre">Event.get_required_actions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.get_optional_actions"><code class="docutils literal notranslate"><span class="pre">Event.get_optional_actions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.get_decisions"><code class="docutils literal notranslate"><span class="pre">Event.get_decisions()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.Event.__init__"><code class="docutils literal notranslate"><span class="pre">Event.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation.base.SimulationClock"><code class="docutils literal notranslate"><span class="pre">SimulationClock</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.SimulationClock.__init__"><code class="docutils literal notranslate"><span class="pre">SimulationClock.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.SimulationClock.schedule_event"><code class="docutils literal notranslate"><span class="pre">SimulationClock.schedule_event()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.SimulationClock.get_next_event"><code class="docutils literal notranslate"><span class="pre">SimulationClock.get_next_event()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation.base.BaseSimulation"><code class="docutils literal notranslate"><span class="pre">BaseSimulation</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.__init__"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.process_event"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.process_event()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.run"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.run()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.register_protocol"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.register_protocol()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.get_protocol"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.get_protocol()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.base.BaseSimulation.schedule_protocol_event"><code class="docutils literal notranslate"><span class="pre">BaseSimulation.schedule_protocol_event()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#key-concepts">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#classes">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-methods">Key Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulation.patient_state.PatientState"><code class="docutils literal notranslate"><span class="pre">PatientState</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.__init__"><code class="docutils literal notranslate"><span class="pre">PatientState.__init__()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.process_visit"><code class="docutils literal notranslate"><span class="pre">PatientState.process_visit()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.update_phase"><code class="docutils literal notranslate"><span class="pre">PatientState.update_phase()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.set_next_visit_interval"><code class="docutils literal notranslate"><span class="pre">PatientState.set_next_visit_interval()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.visit_history"><code class="docutils literal notranslate"><span class="pre">PatientState.visit_history</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.current_vision"><code class="docutils literal notranslate"><span class="pre">PatientState.current_vision</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.last_visit_date"><code class="docutils literal notranslate"><span class="pre">PatientState.last_visit_date</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.patient_state.PatientState.next_visit_interval"><code class="docutils literal notranslate"><span class="pre">PatientState.next_visit_interval</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clinic-scheduler">Clinic Scheduler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-features">Key Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-structure">Configuration Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.config.SimulationConfig"><code class="docutils literal notranslate"><span class="pre">SimulationConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.parameters"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.parameters</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.protocol"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.protocol</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.simulation_type"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.simulation_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.num_patients"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.num_patients</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.duration_days"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.duration_days</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.random_seed"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.random_seed</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.verbose"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.verbose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.start_date"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.start_date</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.resources"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.resources</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_vision_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_vision_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_maintenance_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_maintenance_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_loading_phase_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_loading_phase_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_resource_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_resource_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_des_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_des_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_output_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_output_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.get_clinical_model_params"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.get_clinical_model_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.from_yaml"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.from_yaml()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.config.SimulationConfig.__init__"><code class="docutils literal notranslate"><span class="pre">SimulationConfig.__init__()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Key Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mathematical-model">Mathematical Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-transitions">State Transitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.clinical_model.DiseaseState"><code class="docutils literal notranslate"><span class="pre">DiseaseState</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.DiseaseState.NAIVE"><code class="docutils literal notranslate"><span class="pre">DiseaseState.NAIVE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.DiseaseState.STABLE"><code class="docutils literal notranslate"><span class="pre">DiseaseState.STABLE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.DiseaseState.ACTIVE"><code class="docutils literal notranslate"><span class="pre">DiseaseState.ACTIVE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.DiseaseState.HIGHLY_ACTIVE"><code class="docutils literal notranslate"><span class="pre">DiseaseState.HIGHLY_ACTIVE</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel"><code class="docutils literal notranslate"><span class="pre">ClinicalModel</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel.__init__"><code class="docutils literal notranslate"><span class="pre">ClinicalModel.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel.get_transition_probabilities"><code class="docutils literal notranslate"><span class="pre">ClinicalModel.get_transition_probabilities()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel.simulate_disease_progression"><code class="docutils literal notranslate"><span class="pre">ClinicalModel.simulate_disease_progression()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel.get_initial_vision"><code class="docutils literal notranslate"><span class="pre">ClinicalModel.get_initial_vision()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulation.clinical_model.ClinicalModel.simulate_vision_change"><code class="docutils literal notranslate"><span class="pre">ClinicalModel.simulate_vision_change()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/index.html">Analysis Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/index.html">Protocol Modules</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="patient_state.html">Patient State Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheduler.html">Scheduler Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Simulation Config Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="clinical_model.html">Clinical Model Module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../analysis/eylea_data_analysis.html">Eylea Data Analysis Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis/eylea_intervals_analysis.html">Eylea Intervals Analysis Module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../protocols/visit_types.html">Visit Types Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/config_parser.html">Config Parser Module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../visualization/acuity_viz.html">Visual Acuity Visualization Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Macular Simulation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Simulation Modules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/simulation/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulation-modules">
<h1>Simulation Modules<a class="headerlink" href="#simulation-modules" title="Link to this heading"></a></h1>
<p id="module-simulation.base">Base classes and components for discrete event simulation.</p>
<p>This module provides the fundamental building blocks for discrete event simulation,
including event management, simulation clock, and protocol handling. It defines
the base classes that specific simulation implementations will extend.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Key components:
- Event: Represents discrete simulation events with timing and data
- SimulationClock: Manages event scheduling and time progression
- BaseSimulation: Abstract base class for all simulation implementations
- ProtocolEvent: Protocol-specific event data structure
- SimulationEnvironment: Global simulation state container</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.base.</span></span><span class="sig-name descname"><span class="pre">ProtocolEvent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#ProtocolEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.ProtocolEvent" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Protocol-specific event data.</p>
<p>Represents an event that is specific to a treatment protocol, containing
information about the phase, action, and associated parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phase_type</strong> (<em>PhaseType</em>) – Type of protocol phase this event belongs to (e.g., INITIAL, MAINTENANCE)</p></li>
<li><p><strong>action</strong> (<em>str</em>) – Action to be performed (e.g., ‘inject’, ‘assess’, ‘adjust_interval’)</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>optional</em>) – Additional parameters for the action (default: {})</p></li>
<li><p><strong>result</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Results from executing the action (default: None)</p></li>
</ul>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event</span> <span class="o">=</span> <span class="n">ProtocolEvent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">phase_type</span><span class="o">=</span><span class="n">PhaseType</span><span class="o">.</span><span class="n">MAINTENANCE</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">action</span><span class="o">=</span><span class="s1">&#39;inject&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;drug&#39;</span><span class="p">:</span> <span class="s1">&#39;eylea&#39;</span><span class="p">,</span> <span class="s1">&#39;dose&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent.phase_type">
<span class="sig-name descname"><span class="pre">phase_type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">PhaseType</span></code></em><a class="headerlink" href="#simulation.base.ProtocolEvent.phase_type" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent.action">
<span class="sig-name descname"><span class="pre">action</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#simulation.base.ProtocolEvent.action" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent.parameters">
<span class="sig-name descname"><span class="pre">parameters</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]</span></em><a class="headerlink" href="#simulation.base.ProtocolEvent.parameters" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent.result">
<span class="sig-name descname"><span class="pre">result</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#simulation.base.ProtocolEvent.result" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.ProtocolEvent.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">phase_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#simulation.base.ProtocolEvent.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>phase_type</strong> (<em>PhaseType</em>)</p></li>
<li><p><strong>action</strong> (<em>str</em>)</p></li>
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>)</p></li>
<li><p><strong>result</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>] </em><em>| </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="simulation.base.SimulationEnvironment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.base.</span></span><span class="sig-name descname"><span class="pre">SimulationEnvironment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationEnvironment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationEnvironment" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Global simulation environment.</p>
<p>Maintains global state and timing information for the simulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>start_date</strong> (<em>datetime</em>) – Start date and time for the simulation</p>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>current_time</strong> (<em>datetime</em>) – Current simulation time</p></li>
<li><p><strong>global_state</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Dictionary storing global simulation state including:
- resource_availability: Dict of resource counts
- queue_lengths: Dict of patient queue lengths
- statistics: Aggregated simulation metrics</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The environment provides shared state across all simulation components
and patients. It should be used for system-wide properties rather than
patient-specific state.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.SimulationEnvironment.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationEnvironment.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationEnvironment.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>start_date</strong> (<em>datetime</em>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="simulation.base.Event">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.base.</span></span><span class="sig-name descname"><span class="pre">Event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_event=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Simulation event.</p>
<p>Represents a discrete event in the simulation with timing, type, and associated data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime</em>) – When the event occurs</p></li>
<li><p><strong>event_type</strong> (<em>str</em>) – Type of event (e.g., ‘arrival’, ‘treatment’, ‘assessment’)</p></li>
<li><p><strong>patient_id</strong> (<em>str</em>) – ID of the patient this event relates to</p></li>
<li><p><strong>data</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>optional</em>) – Additional event data (default: {})</p></li>
<li><p><strong>priority</strong> (<em>int</em><em>, </em><em>optional</em>) – Event priority (lower numbers = higher priority) (default: 1)</p></li>
<li><p><strong>protocol_event</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#simulation.base.ProtocolEvent" title="simulation.base.ProtocolEvent"><em>ProtocolEvent</em></a><em>]</em><em>, </em><em>optional</em>) – Associated protocol-specific event data (default: None)</p></li>
<li><p><strong>phase</strong> (<em>Optional</em><em>[</em><em>ProtocolPhase</em><em>]</em><em>, </em><em>optional</em>) – Treatment phase this event belongs to (default: None)</p></li>
<li><p><strong>protocol</strong> (<em>Optional</em><em>[</em><em>TreatmentProtocol</em><em>]</em><em>, </em><em>optional</em>) – Treatment protocol this event belongs to (default: None)</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>_hash</strong> (<em>int</em>) – Internal hash value for event comparison</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Events are comparable and hashable based on their time, type, and patient_id.
This enables proper ordering in priority queues and event lists.</p>
</div>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">time</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">event_type</span><span class="o">=</span><span class="s1">&#39;treatment&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">patient_id</span><span class="o">=</span><span class="s1">&#39;pat123&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;drug&#39;</span><span class="p">:</span> <span class="s1">&#39;eylea&#39;</span><span class="p">,</span> <span class="s1">&#39;dose&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.time">
<span class="sig-name descname"><span class="pre">time</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></em><a class="headerlink" href="#simulation.base.Event.time" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.event_type">
<span class="sig-name descname"><span class="pre">event_type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#simulation.base.Event.event_type" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.patient_id">
<span class="sig-name descname"><span class="pre">patient_id</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#simulation.base.Event.patient_id" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.data">
<span class="sig-name descname"><span class="pre">data</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]</span></em><a class="headerlink" href="#simulation.base.Event.data" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.priority">
<span class="sig-name descname"><span class="pre">priority</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#simulation.base.Event.priority" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.protocol_event">
<span class="sig-name descname"><span class="pre">protocol_event</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><a class="reference internal" href="#simulation.base.ProtocolEvent" title="simulation.base.ProtocolEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProtocolEvent</span></code></a><span class="pre">]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#simulation.base.Event.protocol_event" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.phase">
<span class="sig-name descname"><span class="pre">phase</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">ProtocolPhase</span></code><span class="pre">]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#simulation.base.Event.phase" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.base.Event.protocol">
<span class="sig-name descname"><span class="pre">protocol</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">TreatmentProtocol</span></code><span class="pre">]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#simulation.base.Event.protocol" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.create_protocol_event">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_protocol_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event.create_protocol_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event.create_protocol_event" title="Link to this definition"></a></dt>
<dd><p>Create a protocol-specific event with phase and protocol context.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime</em>) – When the event occurs</p></li>
<li><p><strong>patient_id</strong> (<em>str</em>) – ID of the patient</p></li>
<li><p><strong>phase_type</strong> (<em>PhaseType</em>) – Type of protocol phase</p></li>
<li><p><strong>action</strong> (<em>str</em>) – Action to be performed</p></li>
<li><p><strong>data</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>optional</em>) – Additional event data</p></li>
<li><p><strong>priority</strong> (<em>int</em><em>, </em><em>optional</em>) – Event priority</p></li>
<li><p><strong>phase</strong> (<em>Optional</em><em>[</em><em>ProtocolPhase</em><em>]</em><em>, </em><em>optional</em>) – Treatment phase</p></li>
<li><p><strong>protocol</strong> (<em>Optional</em><em>[</em><em>TreatmentProtocol</em><em>]</em><em>, </em><em>optional</em>) – Treatment protocol</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>New protocol event</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#simulation.base.Event" title="simulation.base.Event">Event</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.get_visit_type">
<span class="sig-name descname"><span class="pre">get_visit_type</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event.get_visit_type"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event.get_visit_type" title="Link to this definition"></a></dt>
<dd><p>Get visit type from phase if available.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Visit type if phase is set, None otherwise</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional[VisitType]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.get_required_actions">
<span class="sig-name descname"><span class="pre">get_required_actions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event.get_required_actions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event.get_required_actions" title="Link to this definition"></a></dt>
<dd><p>Get required actions from visit type.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of required actions for this visit type</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[ActionType]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.get_optional_actions">
<span class="sig-name descname"><span class="pre">get_optional_actions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event.get_optional_actions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event.get_optional_actions" title="Link to this definition"></a></dt>
<dd><p>Get optional actions from visit type.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of optional actions for this visit type</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[ActionType]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.get_decisions">
<span class="sig-name descname"><span class="pre">get_decisions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#Event.get_decisions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.Event.get_decisions" title="Link to this definition"></a></dt>
<dd><p>Get decisions from visit type.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of decisions required for this visit type</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[DecisionType]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.Event.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data=&lt;factory&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_event=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#simulation.base.Event.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime</em>)</p></li>
<li><p><strong>event_type</strong> (<em>str</em>)</p></li>
<li><p><strong>patient_id</strong> (<em>str</em>)</p></li>
<li><p><strong>data</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>)</p></li>
<li><p><strong>priority</strong> (<em>int</em>)</p></li>
<li><p><strong>protocol_event</strong> (<a class="reference internal" href="#simulation.base.ProtocolEvent" title="simulation.base.ProtocolEvent"><em>ProtocolEvent</em></a><em> | </em><em>None</em>)</p></li>
<li><p><strong>phase</strong> (<em>ProtocolPhase</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>protocol</strong> (<em>TreatmentProtocol</em><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="simulation.base.SimulationClock">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.base.</span></span><span class="sig-name descname"><span class="pre">SimulationClock</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationClock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationClock" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Manages simulation time and event scheduling.</p>
<p>Maintains ordered list of events and handles event scheduling with proper
temporal ordering and priority handling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>start_date</strong> (<em>datetime</em>) – Start date and time for the simulation</p>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>current_time</strong> (<em>datetime</em>) – Current simulation time</p></li>
<li><p><strong>end_date</strong> (<em>Optional</em><em>[</em><em>datetime</em><em>]</em>) – End date for the simulation</p></li>
<li><p><strong>event_list</strong> (<em>List</em>) – Ordered list of pending events</p></li>
<li><p><strong>_counter</strong> (<em>int</em>) – Counter for tie-breaking event ordering</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.SimulationClock.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationClock.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationClock.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>start_date</strong> (<em>datetime</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.SimulationClock.schedule_event">
<span class="sig-name descname"><span class="pre">schedule_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationClock.schedule_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationClock.schedule_event" title="Link to this definition"></a></dt>
<dd><p>Schedule an event with proper ordering by time and priority.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<a class="reference internal" href="#simulation.base.Event" title="simulation.base.Event"><em>Event</em></a>) – Event to schedule</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Events are ordered by:
1. Time (earlier events first)
2. Priority (lower numbers = higher priority)
3. Insertion order (tie-breaker)</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.SimulationClock.get_next_event">
<span class="sig-name descname"><span class="pre">get_next_event</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#SimulationClock.get_next_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.SimulationClock.get_next_event" title="Link to this definition"></a></dt>
<dd><p>Get next event without updating clock time.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Next event in chronological order, or None if no events remain</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Optional[<a class="reference internal" href="#simulation.base.Event" title="simulation.base.Event">Event</a>]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.base.</span></span><span class="sig-name descname"><span class="pre">BaseSimulation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">environment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Abstract base class for simulations.</p>
<p>Provides core simulation functionality including event processing,
protocol management, and simulation execution control.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>) – Start date and time for the simulation</p></li>
<li><p><strong>environment</strong> (<em>Optional</em><em>[</em><a class="reference internal" href="#simulation.base.SimulationEnvironment" title="simulation.base.SimulationEnvironment"><em>SimulationEnvironment</em></a><em>]</em><em>, </em><em>optional</em>) – Simulation environment, creates new one if not provided</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>clock</strong> (<a class="reference internal" href="#simulation.base.SimulationClock" title="simulation.base.SimulationClock"><em>SimulationClock</em></a>) – Manages simulation time and events</p></li>
<li><p><strong>metrics</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>List</em><em>[</em><em>Any</em><em>]</em><em>]</em>) – Stores simulation metrics</p></li>
<li><p><strong>environment</strong> (<a class="reference internal" href="#simulation.base.SimulationEnvironment" title="simulation.base.SimulationEnvironment"><em>SimulationEnvironment</em></a>) – Global simulation environment</p></li>
<li><p><strong>protocols</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>TreatmentProtocol</em><em>]</em>) – Registered treatment protocols</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">environment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>datetime</em>)</p></li>
<li><p><strong>environment</strong> (<a class="reference internal" href="#simulation.base.SimulationEnvironment" title="simulation.base.SimulationEnvironment"><em>SimulationEnvironment</em></a><em> | </em><em>None</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.process_event">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">process_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.process_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.process_event" title="Link to this definition"></a></dt>
<dd><p>Process a simulation event.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<a class="reference internal" href="#simulation.base.Event" title="simulation.base.Event"><em>Event</em></a>) – Event to process</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This method must be implemented by concrete simulation classes.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">until</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.run" title="Link to this definition"></a></dt>
<dd><p>Run simulation until specified datetime.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>until</strong> (<em>datetime</em>) – End date and time for the simulation</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p>Processes events chronologically until end time is reached</p></li>
<li><p>Prints progress indicators (dots) for each simulated week</p></li>
<li><p>Includes safety limit to prevent infinite loops</p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.register_protocol">
<span class="sig-name descname"><span class="pre">register_protocol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">protocol_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.register_protocol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.register_protocol" title="Link to this definition"></a></dt>
<dd><p>Register a protocol for use in the simulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>protocol_type</strong> (<em>str</em>) – Identifier for the protocol type</p></li>
<li><p><strong>protocol</strong> (<em>TreatmentProtocol</em>) – Protocol instance to register</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.get_protocol">
<span class="sig-name descname"><span class="pre">get_protocol</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">protocol_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.get_protocol"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.get_protocol" title="Link to this definition"></a></dt>
<dd><p>Get a registered protocol by type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>protocol_type</strong> (<em>str</em>) – Identifier for the protocol type</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Registered protocol or None if not found</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Optional[TreatmentProtocol]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.base.BaseSimulation.schedule_protocol_event">
<span class="sig-name descname"><span class="pre">schedule_protocol_event</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">phase_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/base.html#BaseSimulation.schedule_protocol_event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.base.BaseSimulation.schedule_protocol_event" title="Link to this definition"></a></dt>
<dd><p>Schedule a protocol-specific event.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>time</strong> (<em>datetime</em>) – When the event should occur</p></li>
<li><p><strong>patient_id</strong> (<em>str</em>) – ID of the patient</p></li>
<li><p><strong>phase_type</strong> (<em>PhaseType</em>) – Type of protocol phase</p></li>
<li><p><strong>action</strong> (<em>str</em>) – Action to be performed</p></li>
<li><p><strong>data</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>optional</em>) – Additional event data</p></li>
<li><p><strong>priority</strong> (<em>int</em><em>, </em><em>optional</em>) – Event priority</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="field-list simple" id="module-simulation.patient_state">
<dt class="field-odd">no-index<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>Patient state management for AMD treatment simulation.</p>
<p>This module implements a state machine for tracking individual patient progression
through AMD treatment protocols. It maintains all clinical and treatment-related
state information and handles state transitions during clinic visits.</p>
<section id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="#key-concepts" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>State Machine</strong>:
- Tracks disease state (NAIVE, ACTIVE, INACTIVE, ATROPHIC)
- Manages treatment phases (loading, maintenance, etc.)
- Handles transitions between states based on clinical outcomes</p></li>
<li><p><strong>Clinical Tracking</strong>:
- Visual acuity measurements (ETDRS letters 0-85)
- Treatment history (injections, visits, responses)
- Disease progression over time</p></li>
<li><p><strong>Visit Processing</strong>:
- Handles different visit types and actions
- Updates state based on clinical model outputs
- Maintains complete visit history</p></li>
</ol>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>PatientState</dt><dd><p>Core state machine class tracking all patient attributes and history</p>
</dd>
</dl>
</section>
<section id="key-methods">
<h2>Key Methods<a class="headerlink" href="#key-methods" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>process_visit()</dt><dd><p>Main entry point for processing clinic visits and updating state</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<p>Basic Usage:
&gt;&gt;&gt; model = ClinicalModel()
&gt;&gt;&gt; patient = PatientState(“123”, “treat_and_extend”, 70, datetime.now())
&gt;&gt;&gt; visit_data = patient.process_visit(
…     datetime.now(),
…     [“vision_test”, “injection”],
…     model
… )
&gt;&gt;&gt; print(f”Vision change: {visit_data[‘vision_change’]} letters”)</p>
<p>Advanced Usage:
&gt;&gt;&gt; # Custom treatment protocol with phase transitions
&gt;&gt;&gt; patient = PatientState(“456”, “custom_protocol”, 65, datetime.now())
&gt;&gt;&gt; while patient.visits &lt; 24:
…     visit_data = patient.process_visit(
…         datetime.now(),
…         [“vision_test”, “oct_scan”, “injection”],
…         model
…     )
…     if visit_data[“vision_change”] &lt; -5:
…         patient.update_phase(“intensified_treatment”)</p>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p>Visual acuity measurements use ETDRS letters (0-85 range)</p></li>
<li><p>Disease states follow ClinicalModel definitions</p></li>
<li><p>Visit intervals are clamped between 4-52 weeks</p></li>
<li><p>All state changes are recorded in visit_history</p></li>
</ul>
</div>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.patient_state.</span></span><span class="sig-name descname"><span class="pre">PatientState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_vision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/patient_state.html#PatientState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.patient_state.PatientState" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">No-index<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>patient_id</strong> (<em>str</em>)</p></li>
<li><p><strong>protocol_name</strong> (<em>str</em>)</p></li>
<li><p><strong>initial_vision</strong> (<em>float</em>)</p></li>
<li><p><strong>start_time</strong> (<em>datetime</em>)</p></li>
</ul>
</dd>
</dl>
<p>Manages patient state and history throughout the simulation.</p>
<p>This class maintains the complete state of a patient including their treatment history,
vision measurements, disease state, and scheduled visits. It provides methods for
processing clinic visits and updating patient state based on treatments and disease
progression.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>patient_id</strong> (<em>str</em>) – Unique identifier for the patient</p></li>
<li><p><strong>protocol_name</strong> (<em>str</em>) – Name of the treatment protocol</p></li>
<li><p><strong>initial_vision</strong> (<em>float</em>) – Baseline visual acuity (ETDRS letters)</p></li>
<li><p><strong>start_time</strong> (<em>datetime</em>) – Time when patient enters the simulation</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>MAX_TREATMENTS_IN_PHASE</strong> (<em>int</em>) – Maximum allowed treatments in a phase (default: 1000)</p></li>
<li><p><strong>patient_id</strong> (<em>str</em>) – Unique identifier for the patient</p></li>
<li><p><strong>state</strong> (<em>Dict</em>) – Dictionary containing all patient state information including:
- protocol: Treatment protocol name
- current_step: Current treatment phase
- visits: Total number of visits
- injections: Total number of injections
- baseline_vision: Initial visual acuity
- current_vision: Current visual acuity
- disease_state: Current disease state
- last_visit_date: Date of last visit
- next_visit_interval: Weeks until next visit
- treatment_start: Date treatment began
- visit_history: List of all visits
- best_vision_achieved: Highest vision recorded
- last_treatment_response: Most recent treatment response
- treatment_response_history: List of all responses
- weeks_since_last_injection: Weeks since last injection
- last_injection_date: Date of last injection</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The state dictionary maintains a complete record of the patient’s:
- Treatment history and responses
- Vision measurements over time
- Disease progression
- Visit schedule and history</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">patient_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_vision</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_time</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/patient_state.html#PatientState.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.patient_state.PatientState.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>patient_id</strong> (<em>str</em>)</p></li>
<li><p><strong>protocol_name</strong> (<em>str</em>)</p></li>
<li><p><strong>initial_vision</strong> (<em>float</em>)</p></li>
<li><p><strong>start_time</strong> (<em>datetime</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.process_visit">
<span class="sig-name descname"><span class="pre">process_visit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">visit_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clinical_model</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/patient_state.html#PatientState.process_visit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.patient_state.PatientState.process_visit" title="Link to this definition"></a></dt>
<dd><p>Process a clinic visit and update patient state.</p>
<p>This is the main state transition method that handles all visit processing
and state updates. It coordinates vision testing, treatment administration,
and disease state transitions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>visit_time</strong> (<em>datetime</em>) – Time of the visit (must be timezone-naive UTC)
Example: datetime(2025, 4, 15)</p></li>
<li><p><strong>actions</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – <dl class="simple">
<dt>List of actions performed during the visit. Valid actions:</dt><dd><ul>
<li><p>”vision_test”: Measures visual acuity</p></li>
<li><p>”oct_scan”: Performs OCT imaging</p></li>
<li><p>”injection”: Administers anti-VEGF treatment</p></li>
</ul>
</dd>
</dl>
<p>Example: [“vision_test”, “oct_scan”, “injection”]</p>
</p></li>
<li><p><strong>clinical_model</strong> (<a class="reference internal" href="#simulation.clinical_model.ClinicalModel" title="simulation.clinical_model.ClinicalModel"><em>ClinicalModel</em></a>) – ClinicalModel instance for simulating vision changes and disease progression
Must be initialized with appropriate parameters</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Dictionary containing detailed visit results:</dt><dd><ul class="simple">
<li><p>vision_change: float - Change in ETDRS letters</p></li>
<li><p>actions_performed: List[str] - Completed actions</p></li>
<li><p>disease_state: DiseaseState - Updated state</p></li>
<li><p>treatment_response: Optional[Dict] - If injection given</p></li>
<li><p>visit_type: str - Classification of visit</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[str, Any]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If visit_time is timezone-aware
    If actions contains invalid values
    If clinical_model is not properly initialized</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<p>Basic Visit:
&gt;&gt;&gt; model = ClinicalModel(config)
&gt;&gt;&gt; patient = PatientState(“123”, “treat_and_extend”, 70, datetime.now())
&gt;&gt;&gt; visit_data = patient.process_visit(
…     datetime.now(),
…     [“vision_test”, “injection”],
…     model
… )</p>
<p>Monitoring Visit:
&gt;&gt;&gt; visit_data = patient.process_visit(
…     datetime.now(),
…     [“vision_test”, “oct_scan”],
…     model
… )</p>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>State Updates:
1. Increments visit counter
2. Updates last visit date
3. Calculates weeks since last injection
4. Simulates vision changes using clinical_model
5. Processes each action in sequence
6. Records complete visit details</p>
<p>The method handles:
- Validation of input parameters
- Coordination of state updates
- Error handling for invalid states
- Complete visit recording</p>
<p>Vision changes are simulated by the clinical_model which considers:
- Current disease state
- Treatment history
- Time since last injection
- Current vision level</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.update_phase">
<span class="sig-name descname"><span class="pre">update_phase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_phase</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/patient_state.html#PatientState.update_phase"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.patient_state.PatientState.update_phase" title="Link to this definition"></a></dt>
<dd><p>Update treatment phase.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_phase</strong> (<em>str</em>) – Name of the new treatment phase</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.set_next_visit_interval">
<span class="sig-name descname"><span class="pre">set_next_visit_interval</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weeks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/patient_state.html#PatientState.set_next_visit_interval"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.patient_state.PatientState.set_next_visit_interval" title="Link to this definition"></a></dt>
<dd><p>Set interval until next scheduled visit.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>weeks</strong> (<em>int</em>) – Number of weeks until next visit</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Interval is clamped between 4 and 52 weeks.</p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.visit_history">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">visit_history</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#simulation.patient_state.PatientState.visit_history" title="Link to this definition"></a></dt>
<dd><p>Get patient’s visit history.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of visit records in chronological order</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>List[Dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.current_vision">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">current_vision</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#simulation.patient_state.PatientState.current_vision" title="Link to this definition"></a></dt>
<dd><p>Get patient’s current visual acuity.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Current vision in ETDRS letters</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.last_visit_date">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">last_visit_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">datetime</span></em><a class="headerlink" href="#simulation.patient_state.PatientState.last_visit_date" title="Link to this definition"></a></dt>
<dd><p>Get date of patient’s last visit.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Date and time of the most recent visit</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>datetime</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="simulation.patient_state.PatientState.next_visit_interval">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">next_visit_interval</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#simulation.patient_state.PatientState.next_visit_interval" title="Link to this definition"></a></dt>
<dd><p>Get weeks until next scheduled visit.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of weeks until next scheduled visit</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="clinic-scheduler">
<h2>Clinic Scheduler<a class="headerlink" href="#clinic-scheduler" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.scheduler.</span></span><span class="sig-name descname"><span class="pre">ClinicScheduler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_capacity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days_per_week</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/scheduler.html#ClinicScheduler"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Manages clinic scheduling and resource allocation.</p>
<p>This class handles the scheduling of patient visits while respecting clinic
capacity constraints. It supports configurable daily patient capacity and
working days per week, with automatic rescheduling when capacity is exceeded.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_capacity</strong> (<em>int</em>) – Maximum number of patients that can be seen per day</p></li>
<li><p><strong>days_per_week</strong> (<em>int</em>) – Number of clinic days per week (e.g., 5 for Mon-Fri)</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>daily_capacity</strong> (<em>int</em>) – Maximum patients per day</p></li>
<li><p><strong>days_per_week</strong> (<em>int</em>) – Working days per week</p></li>
<li><p><strong>daily_slots</strong> (<em>Dict</em><em>[</em><em>datetime</em><em>, </em><em>int</em><em>]</em>) – Tracks number of appointments for each date</p></li>
<li><p><strong>rescheduled_visits</strong> (<em>int</em>) – Counter for number of rescheduled appointments</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_capacity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">days_per_week</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/scheduler.html#ClinicScheduler.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_capacity</strong> (<em>int</em>)</p></li>
<li><p><strong>days_per_week</strong> (<em>int</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">request_slot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/scheduler.html#ClinicScheduler.request_slot"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Check if there’s capacity for a visit on the requested day.</p>
<p>Verifies if the requested visit can be accommodated on the specified day,
considering both clinic working days and daily capacity constraints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event</strong> (<a class="reference internal" href="#simulation.base.Event" title="simulation.base.Event"><em>Event</em></a>) – Event containing visit details including requested time</p></li>
<li><p><strong>end_date</strong> (<em>datetime</em>) – Simulation end date for rescheduling bounds</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if slot is available, False if needs rescheduling</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">scheduler</span><span class="o">.</span><span class="n">request_slot</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Slot available&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Visit needs rescheduling&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p>Automatically initializes tracking for new dates</p></li>
<li><p>Handles non-clinic days (e.g., weekends) by rescheduling</p></li>
<li><p>Updates appointment counts when slot is granted</p></li>
<li><p>Rescheduling maintains original appointment details</p></li>
<li><p>Time values should be timezone-naive datetimes</p></li>
</ul>
<ol class="arabic simple">
<li><p>Check if requested date is a clinic day</p></li>
<li><p>Initialize slot count if new date</p></li>
<li><p>Check daily capacity</p></li>
<li><p>If no capacity or non-clinic day, trigger rescheduling</p></li>
<li><p>If capacity available, increment count and return True</p></li>
</ol>
</div>
</dd></dl>

</dd></dl>

<p id="module-simulation.config">Simulation configuration management.</p>
<p>This module handles the configuration of simulation runs, including parameter validation,
protocol integration, and resource management. It ensures all simulation parameters
are properly validated before being used in a simulation run.</p>
<section id="id1">
<h3>Classes<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>SimulationConfig</dt><dd><p>Main configuration class that encapsulates all simulation parameters</p>
</dd>
</dl>
</section>
<section id="key-features">
<h3>Key Features<a class="headerlink" href="#key-features" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Parameter validation for all configuration sections</p></li>
<li><p>Protocol integration with validation</p></li>
<li><p>Resource management</p></li>
<li><p>Default value handling</p></li>
<li><p>Type checking and range validation</p></li>
</ul>
</section>
<section id="configuration-structure">
<h3>Configuration Structure<a class="headerlink" href="#configuration-structure" title="Link to this heading"></a></h3>
<p>Example YAML configuration structure:
<a href="#id2"><span class="problematic" id="id3">``</span></a><a href="#id4"><span class="problematic" id="id5">`</span></a>yaml
simulation:</p>
<blockquote>
<div><p>type: “des”
num_patients: 1000
duration_days: 365
random_seed: 42
verbose: true
start_date: “2023-01-01”
resources:</p>
<blockquote>
<div><dl class="simple">
<dt>capacity:</dt><dd><p>doctors: 5
nurses: 10
oct_machines: 3</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl>
<dt>clinical_model:</dt><dd><p>disease_states: [“NAIVE”, “STABLE”, “ACTIVE”, “HIGHLY_ACTIVE”]
transition_probabilities:</p>
<blockquote>
<div><dl class="simple">
<dt>NAIVE:</dt><dd><p>STABLE: 0.3
ACTIVE: 0.6
HIGHLY_ACTIVE: 0.1</p>
</dd>
<dt>STABLE:</dt><dd><p>STABLE: 0.7
ACTIVE: 0.3</p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>vision_change:</dt><dd><dl class="simple">
<dt>base_change:</dt><dd><dl class="simple">
<dt>NAIVE:</dt><dd><p>injection: [5, 2]
no_injection: [0, 1]</p>
</dd>
<dt>STABLE:</dt><dd><p>injection: [2, 1]
no_injection: [-1, 0.5]</p>
</dd>
</dl>
</dd>
<dt>time_factor:</dt><dd><p>max_weeks: 52</p>
</dd>
<dt>ceiling_factor:</dt><dd><p>max_vision: 100</p>
</dd>
</dl>
<p>measurement_noise: [0, 0.5]</p>
</dd>
</dl>
</dd>
</dl>
<p><a href="#id6"><span class="problematic" id="id7">``</span></a><a href="#id8"><span class="problematic" id="id9">`</span></a></p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p>All numeric parameters are validated against expected ranges</p></li>
<li><p>Probability parameters must sum to 1 where applicable</p></li>
<li><p>Dates must be in YYYY-MM-DD format</p></li>
<li><p>Missing parameters will use sensible defaults where possible</p></li>
</ul>
</div>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.config.</span></span><span class="sig-name descname"><span class="pre">SimulationConfig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simulation_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_patients</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration_days</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Configuration for a simulation run with protocol objects.</p>
<p>This class encapsulates all configuration parameters needed to run a simulation,
including treatment protocols, patient parameters, and resource constraints.
Provides validation methods for all configuration sections.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Dictionary of simulation parameters</p></li>
<li><p><strong>protocol</strong> (<em>TreatmentProtocol</em>) – Treatment protocol to use in simulation</p></li>
<li><p><strong>simulation_type</strong> (<em>str</em>) – Type of simulation (‘abs’ or ‘des’)</p></li>
<li><p><strong>num_patients</strong> (<em>int</em>) – Number of patients to simulate</p></li>
<li><p><strong>duration_days</strong> (<em>int</em>) – Duration of simulation in days</p></li>
<li><p><strong>random_seed</strong> (<em>int</em>) – Random seed for reproducibility</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Whether to enable verbose logging</p></li>
<li><p><strong>start_date</strong> (<em>datetime</em>) – Simulation start date</p></li>
<li><p><strong>resources</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>, </em><em>optional</em>) – Resource configuration dictionary</p></li>
</ul>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Raw simulation parameters</p></li>
<li><p><strong>protocol</strong> (<em>TreatmentProtocol</em>) – Treatment protocol instance</p></li>
<li><p><strong>simulation_type</strong> (<em>str</em>) – Simulation type identifier</p></li>
<li><p><strong>num_patients</strong> (<em>int</em>) – Number of simulated patients</p></li>
<li><p><strong>duration_days</strong> (<em>int</em>) – Simulation duration</p></li>
<li><p><strong>random_seed</strong> (<em>int</em>) – Random seed value</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Verbosity flag</p></li>
<li><p><strong>start_date</strong> (<em>datetime</em>) – Simulation start date</p></li>
<li><p><strong>resources</strong> (<em>Optional</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em>) – Resource configuration</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.parameters">
<span class="sig-name descname"><span class="pre">parameters</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]</span></em><a class="headerlink" href="#simulation.config.SimulationConfig.parameters" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.protocol">
<span class="sig-name descname"><span class="pre">protocol</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">TreatmentProtocol</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.protocol" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.simulation_type">
<span class="sig-name descname"><span class="pre">simulation_type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.simulation_type" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.num_patients">
<span class="sig-name descname"><span class="pre">num_patients</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.num_patients" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.duration_days">
<span class="sig-name descname"><span class="pre">duration_days</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.duration_days" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.random_seed">
<span class="sig-name descname"><span class="pre">random_seed</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.random_seed" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.verbose">
<span class="sig-name descname"><span class="pre">verbose</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.verbose" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.start_date">
<span class="sig-name descname"><span class="pre">start_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></em><a class="headerlink" href="#simulation.config.SimulationConfig.start_date" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.resources">
<span class="sig-name descname"><span class="pre">resources</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code><span class="pre">,</span> <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code><span class="pre">]]</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#simulation.config.SimulationConfig.resources" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_vision_params">
<span class="sig-name descname"><span class="pre">get_vision_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_vision_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_vision_params" title="Link to this definition"></a></dt>
<dd><p>Get validated vision-related parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Validated vision parameters</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If required parameters are missing or invalid</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Validates the following parameters:
- baseline_mean: Valid ETDRS letter range (30-85)
- measurement_noise_sd: Reasonable measurement noise (0-5)
- max_letters: ETDRS maximum (0-100)
- min_letters: ETDRS minimum (0-30)
- headroom_factor: Must be between 0 and 1</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_maintenance_params">
<span class="sig-name descname"><span class="pre">get_maintenance_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_maintenance_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_maintenance_params" title="Link to this definition"></a></dt>
<dd><p>Get validated maintenance phase parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Validated maintenance phase parameters</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If required parameters are missing or invalid</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Validates the following parameters:
- memory_factor: Must be between 0 and 1
- base_effect_ceiling: Maximum reasonable improvement (0-15)
- regression_factor: Must be between 0 and 1
- random_effect_mean: Reasonable range for log-normal mean (-2 to 2)
- random_effect_sd: Reasonable range for log-normal SD (0 to 1)
- decline_probability: Must be probability (0 to 1)
- decline_effect_mean: Reasonable vision loss range (-5 to 0)
- decline_effect_sd: Reasonable variation in loss (0 to 2)</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_loading_phase_params">
<span class="sig-name descname"><span class="pre">get_loading_phase_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_loading_phase_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_loading_phase_params" title="Link to this definition"></a></dt>
<dd><p>Get validated loading phase parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Validated loading phase parameters</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If required parameters are missing, invalid, or probabilities don’t sum to 1</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Validates the following parameters:
- vision_improvement_mean: Reasonable letter improvement (0-15)
- vision_improvement_sd: Reasonable variation (0-5)
- improve_probability: Must be probability (0-1)
- stable_probability: Must be probability (0-1)
- decline_probability: Must be probability (0-1)</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_resource_params">
<span class="sig-name descname"><span class="pre">get_resource_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_resource_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_resource_params" title="Link to this definition"></a></dt>
<dd><p>Get resource configuration parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Resource parameters with defaults:
- doctors: 5
- nurses: 5
- oct_machines: 5</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>First checks simulation.resources.capacity if it exists,
otherwise falls back to default values.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_des_params">
<span class="sig-name descname"><span class="pre">get_des_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_des_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_des_params" title="Link to this definition"></a></dt>
<dd><p>Get DES-specific parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>DES parameters with defaults:
- daily_capacity: 20 patients
- days_per_week: 5 days
- patient_generation:</p>
<blockquote>
<div><ul class="simple">
<li><p>rate_per_week: 3 patients</p></li>
<li><p>random_seed: None (use simulation seed)</p></li>
</ul>
</div></blockquote>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_output_params">
<span class="sig-name descname"><span class="pre">get_output_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_output_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_output_params" title="Link to this definition"></a></dt>
<dd><p>Get output configuration parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Output parameters with defaults:
- save_results: True
- database: ‘simulations.db’
- plots: True
- verbose: False</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.get_clinical_model_params">
<span class="sig-name descname"><span class="pre">get_clinical_model_params</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.get_clinical_model_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.get_clinical_model_params" title="Link to this definition"></a></dt>
<dd><p>Get validated clinical model parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Validated clinical model parameters</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict[str, Any]</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If required sections or parameters are missing</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Validates the following required sections:
- disease_states
- transition_probabilities
- vision_change</p>
<p>For vision_change, validates:
- base_change
- time_factor
- ceiling_factor
- measurement_noise</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.from_yaml">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_yaml</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_name</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/config.html#SimulationConfig.from_yaml"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.config.SimulationConfig.from_yaml" title="Link to this definition"></a></dt>
<dd><p>Create configuration from YAML with protocol objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config_name</strong> (<em>str</em>) – Name of the configuration to load</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>New SimulationConfig instance</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#simulation.config.SimulationConfig" title="simulation.config.SimulationConfig">SimulationConfig</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If protocol is invalid or required parameters are missing</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Uses ProtocolParser to load and validate the full configuration,
including protocol definitions and parameter validation.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.config.SimulationConfig.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">protocol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simulation_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_patients</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration_days</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_seed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resources</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#simulation.config.SimulationConfig.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>parameters</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>)</p></li>
<li><p><strong>protocol</strong> (<em>TreatmentProtocol</em>)</p></li>
<li><p><strong>simulation_type</strong> (<em>str</em>)</p></li>
<li><p><strong>num_patients</strong> (<em>int</em>)</p></li>
<li><p><strong>duration_days</strong> (<em>int</em>)</p></li>
<li><p><strong>random_seed</strong> (<em>int</em>)</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>)</p></li>
<li><p><strong>start_date</strong> (<em>datetime</em>)</p></li>
<li><p><strong>resources</strong> (<em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>] </em><em>| </em><em>None</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p id="module-simulation.clinical_model">Clinical model for AMD disease progression and vision changes.</p>
<p>This module implements the clinical aspects of AMD progression, including disease states,
vision changes, and treatment effects. It uses a state-based model with probabilistic
transitions and configurable parameters for vision changes.</p>
<p>This module implements the clinical aspects of AMD progression, including disease states,
vision changes, and treatment effects. It uses a state-based model with probabilistic
transitions and configurable parameters for vision changes.</p>
<section id="id10">
<h3>Classes<a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>DiseaseState</dt><dd><p>Enumeration of possible AMD disease states</p>
</dd>
<dt>ClinicalModel</dt><dd><p>Core class implementing disease progression and vision change logic</p>
</dd>
</dl>
</section>
<section id="id11">
<h3>Key Features<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Four disease states (NAIVE, STABLE, ACTIVE, HIGHLY_ACTIVE)</p></li>
<li><p>Configurable transition probabilities between states</p></li>
<li><dl class="simple">
<dt>Vision change modeling with:</dt><dd><ul>
<li><p>State-dependent base changes</p></li>
<li><p>Time since last injection factor</p></li>
<li><p>Vision ceiling effect</p></li>
<li><p>Measurement noise</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Injection vs non-injection visit differentiation</p></li>
</ul>
</section>
<section id="mathematical-model">
<h3>Mathematical Model<a class="headerlink" href="#mathematical-model" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>Vision change is calculated as:</dt><dd><p>ΔV = (B × T × C) + N</p>
</dd>
<dt>Where:</dt><dd><p>ΔV: Vision change (ETDRS letters)
B: Base change (state and injection dependent)
T: Time factor (1 + weeks_since_injection/max_weeks)
C: Ceiling factor (1 - current_vision/max_vision)
N: Measurement noise (normally distributed)</p>
</dd>
</dl>
</section>
<section id="state-transitions">
<h3>State Transitions<a class="headerlink" href="#state-transitions" title="Link to this heading"></a></h3>
<p>NAIVE → STABLE: 30%
NAIVE → ACTIVE: 60%
NAIVE → HIGHLY_ACTIVE: 10%
Other transitions configurable via parameters</p>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">SimulationConfig</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;protocols/eylea.yaml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ClinicalModel</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disease_state&quot;</span><span class="p">:</span> <span class="s2">&quot;NAIVE&quot;</span><span class="p">,</span> <span class="s2">&quot;injections&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vision_change</span><span class="p">,</span> <span class="n">new_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate_vision_change</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<ul class="simple">
<li><p>Vision measured in ETDRS letters (0-100 range)</p></li>
<li><p>Positive ΔV indicates vision improvement</p></li>
<li><p>Time factor increases linearly with weeks since last injection</p></li>
<li><p>Ceiling effect reduces changes as vision approaches maximum</p></li>
</ul>
</div>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="simulation.clinical_model.DiseaseState">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.clinical_model.</span></span><span class="sig-name descname"><span class="pre">DiseaseState</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names=&lt;not</span> <span class="pre">given&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*values</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qualname=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start=1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#DiseaseState"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.DiseaseState" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Disease states for AMD progression.</p>
<p>Enumeration of possible disease states in the AMD progression model.</p>
<dl class="field-list simple">
<dt class="field-odd">Variables<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>NAIVE</strong> (<em>Enum</em>) – Initial state for new patients with no prior treatment.
Typically transitions to other states in first visit.</p></li>
<li><p><strong>STABLE</strong> (<em>Enum</em>) – Disease is under control with minimal activity.
Patients typically maintain or slightly improve vision.</p></li>
<li><p><strong>ACTIVE</strong> (<em>Enum</em>) – Disease shows signs of activity with fluid accumulation.
Patients typically experience vision decline without treatment.</p></li>
<li><p><strong>HIGHLY_ACTIVE</strong> (<em>Enum</em>) – Disease shows high levels of activity with significant fluid.
Patients experience rapid vision decline without treatment.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>State transitions are probabilistic and configurable via ClinicalModel.
Default transition probabilities from NAIVE state:</p>
<blockquote>
<div><ul class="simple">
<li><p>STABLE: 30%</p></li>
<li><p>ACTIVE: 60%</p></li>
<li><p>HIGHLY_ACTIVE: 10%</p></li>
</ul>
</div></blockquote>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.clinical_model.DiseaseState.NAIVE">
<span class="sig-name descname"><span class="pre">NAIVE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0</span></em><a class="headerlink" href="#simulation.clinical_model.DiseaseState.NAIVE" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.clinical_model.DiseaseState.STABLE">
<span class="sig-name descname"><span class="pre">STABLE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#simulation.clinical_model.DiseaseState.STABLE" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.clinical_model.DiseaseState.ACTIVE">
<span class="sig-name descname"><span class="pre">ACTIVE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#simulation.clinical_model.DiseaseState.ACTIVE" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="simulation.clinical_model.DiseaseState.HIGHLY_ACTIVE">
<span class="sig-name descname"><span class="pre">HIGHLY_ACTIVE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#simulation.clinical_model.DiseaseState.HIGHLY_ACTIVE" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">simulation.clinical_model.</span></span><span class="sig-name descname"><span class="pre">ClinicalModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">No-index<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>config</strong> (<a class="reference internal" href="#simulation.config.SimulationConfig" title="simulation.config.SimulationConfig"><em>SimulationConfig</em></a>)</p>
</dd>
</dl>
<p>Models clinical aspects of AMD progression, including disease states and vision changes.</p>
<p>This model includes four disease states: NAIVE, STABLE, ACTIVE, and HIGHLY_ACTIVE.
It simulates disease progression and vision changes based on the current state and treatment.</p>
<p>The model uses configurable transition probabilities between states and simulates vision changes
with normal distributions, differentiating between injection and non-injection visits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#simulation.config.SimulationConfig" title="simulation.config.SimulationConfig"><em>simulation.config.SimulationConfig</em></a>) – <dl class="simple">
<dt>Configuration object containing:</dt><dd><ul class="simple">
<li><p>clinical_model_params: Clinical model parameters</p></li>
<li><p>vision_params: Vision change parameters</p></li>
<li><p>transition_probabilities: State transition probabilities</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Variables<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>config</strong> (<a class="reference internal" href="#simulation.config.SimulationConfig" title="simulation.config.SimulationConfig"><em>simulation.config.SimulationConfig</em></a>) – Configuration object containing model parameters</p></li>
<li><p><strong>transition_probabilities</strong> (<em>Dict</em><em>[</em><a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState"><em>DiseaseState</em></a><em>, </em><em>Dict</em><em>[</em><a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState"><em>DiseaseState</em></a><em>, </em><em>float</em><em>]</em><em>]</em>) – <p>Probability matrix for transitions between disease states with structure:
{</p>
<blockquote>
<div><p>DiseaseState.NAIVE: {DiseaseState.STABLE: 0.3, …},
DiseaseState.STABLE: {DiseaseState.STABLE: 0.7, …},
…</p>
</div></blockquote>
<p>}</p>
</p></li>
<li><p><strong>vision_change_params</strong> (<em>Dict</em>) – Parameters controlling vision changes under different conditions including:
- base_change: Mean/SD for each state and injection status
- time_factor: Effect of time since last injection
- ceiling_factor: Vision ceiling effect
- measurement_noise: Random variability</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The model captures key clinical aspects of AMD progression:
1. State-dependent response to treatment
2. Waning of treatment effect over time
3. Diminishing returns at higher vision levels
4. Realistic measurement variability</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel.__init__" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<a class="reference internal" href="#simulation.config.SimulationConfig" title="simulation.config.SimulationConfig"><em>SimulationConfig</em></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel.get_transition_probabilities">
<span class="sig-name descname"><span class="pre">get_transition_probabilities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current_state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel.get_transition_probabilities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel.get_transition_probabilities" title="Link to this definition"></a></dt>
<dd><p>Get transition probabilities for the current disease state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>current_state</strong> (<a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState"><em>DiseaseState</em></a>) – Current disease state (NAIVE, STABLE, ACTIVE, or HIGHLY_ACTIVE)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary mapping possible next states to their transition probabilities</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dict[<a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState">DiseaseState</a>, float]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If no transition probabilities are defined for the current state</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel.simulate_disease_progression">
<span class="sig-name descname"><span class="pre">simulate_disease_progression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current_state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel.simulate_disease_progression"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel.simulate_disease_progression" title="Link to this definition"></a></dt>
<dd><p>Simulate disease state progression using configured transition probabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>current_state</strong> (<a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState"><em>DiseaseState</em></a>) – Current disease state (NAIVE, STABLE, ACTIVE, or HIGHLY_ACTIVE)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>New disease state after progression</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState">DiseaseState</a></p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If current_state is not a valid DiseaseState</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ClinicalModel</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">current_state</span> <span class="o">=</span> <span class="n">DiseaseState</span><span class="o">.</span><span class="n">NAIVE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate_disease_progression</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transitioned from </span><span class="si">{</span><span class="n">current_state</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Disease progression follows these rules:
1. NAIVE state has fixed transition probabilities:</p>
<blockquote>
<div><ul class="simple">
<li><p>STABLE: 30%</p></li>
<li><p>ACTIVE: 60%</p></li>
<li><p>HIGHLY_ACTIVE: 10%</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Other states use probabilities from configuration</p></li>
<li><p>If no probabilities defined, remains in current state</p></li>
<li><p>Probabilities are normalized to sum to 1 if needed</p></li>
</ol>
<p>The method handles:
- Validation of current_state
- Special case for NAIVE state
- Probability normalization
- Random selection of next state
- Debug logging of transitions</p>
<p>Transition probabilities represent clinical observations of AMD progression:
- NAIVE patients most likely to transition to ACTIVE state
- STABLE patients typically remain stable
- ACTIVE patients may progress to HIGHLY_ACTIVE or regress to STABLE</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel.get_initial_vision">
<span class="sig-name descname"><span class="pre">get_initial_vision</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel.get_initial_vision"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel.get_initial_vision" title="Link to this definition"></a></dt>
<dd><p>Get initial vision for a new patient.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Initial vision score (ETDRS letters)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>int</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Uses normal distribution with configurable mean and standard deviation.
Defaults to mean=70, sd=5 if not specified in configuration.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="simulation.clinical_model.ClinicalModel.simulate_vision_change">
<span class="sig-name descname"><span class="pre">simulate_vision_change</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/simulation/clinical_model.html#ClinicalModel.simulate_vision_change"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#simulation.clinical_model.ClinicalModel.simulate_vision_change" title="Link to this definition"></a></dt>
<dd><p>Calculate vision change and new disease state based on current state and treatment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<em>Dict</em>) – <dl class="simple">
<dt>Current patient state dictionary with these required keys:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>disease_state: Current disease state (str or DiseaseState)</dt><dd><p>Must be one of: NAIVE, STABLE, ACTIVE, HIGHLY_ACTIVE</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>injections: Total number of injections (int)</dt><dd><p>Count of all injections received</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>last_recorded_injection: Number of last recorded injection (int)</dt><dd><p>Used to detect new injections</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>weeks_since_last_injection: Weeks since last injection (int)</dt><dd><p>Used in time factor calculation</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>current_vision: Current vision score (ETDRS letters, int)</dt><dd><p>Must be between 0-100 (will be clamped if outside range)</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Optional keys:</dt><dd><ul class="simple">
<li><p>debug: bool - Enable debug output if True</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Tuple containing:</dt><dd><ul class="simple">
<li><p>Vision change in ETDRS letters (positive = improvement)</p></li>
<li><p>New disease state</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple[float, <a class="reference internal" href="#simulation.clinical_model.DiseaseState" title="simulation.clinical_model.DiseaseState">DiseaseState</a>]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If required vision change parameters are missing from configuration</p>
</dd>
</dl>
<div class="admonition-examples admonition">
<p class="admonition-title">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;disease_state&quot;</span><span class="p">:</span> <span class="s2">&quot;NAIVE&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;injections&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;last_recorded_injection&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;weeks_since_last_injection&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;current_vision&quot;</span><span class="p">:</span> <span class="mi">70</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vision_change</span><span class="p">,</span> <span class="n">new_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate_vision_change</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vision changed by </span><span class="si">{</span><span class="n">vision_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> letters&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<dl class="simple">
<dt>Mathematical Model:</dt><dd><p>ΔV = (B × T × C) + N</p>
</dd>
<dt>Where:</dt><dd><dl class="simple">
<dt>ΔV: Vision change (ETDRS letters)</dt><dd><p>Positive values indicate vision improvement
Negative values indicate vision decline</p>
</dd>
<dt>B: Base change (state and injection dependent)</dt><dd><ul class="simple">
<li><p>Normally distributed: N(μ, σ)</p></li>
<li><p>μ and σ configured per state in vision_change_params</p></li>
<li><p>Separate distributions for injection vs non-injection visits</p></li>
<li><dl class="simple">
<dt>Typical ranges:</dt><dd><p>Injection: μ = +5 to +15 letters
Non-injection: μ = -5 to +5 letters</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>T: Time factor (1 + weeks_since_injection/max_weeks)</dt><dd><ul class="simple">
<li><p>Models decreasing treatment effect over time</p></li>
<li><p>max_weeks typically 52 (1 year) from config</p></li>
<li><p>Ranges from 1 (immediate post-injection) to 2 (1 year post-injection)</p></li>
</ul>
</dd>
<dt>C: Ceiling factor (1 - current_vision/max_vision)</dt><dd><ul class="simple">
<li><p>max_vision typically 100 letters from config</p></li>
<li><p>Ranges from 1 (0 letters) to 0 (100 letters)</p></li>
<li><p>Limits unrealistic vision improvements at high acuity</p></li>
</ul>
</dd>
<dt>N: Measurement noise (normally distributed)</dt><dd><ul class="simple">
<li><p>Represents test-retest variability</p></li>
<li><p>Typically N(0, 0.5) letters from config</p></li>
</ul>
</dd>
</dl>
</dd>
<dt>Edge Cases:</dt><dd><ul class="simple">
<li><p>If current_vision &gt; max_vision, ceiling_factor is clamped to 0</p></li>
<li><p>If weeks_since_injection &gt; max_weeks, time_factor is clamped to 2</p></li>
<li><dl class="simple">
<dt>If state missing required keys, uses defaults:</dt><dd><p>weeks_since_injection=0, current_vision=70</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>The model captures key clinical aspects:
1. State-dependent response to treatment
2. Waning of treatment effect over time
3. Diminishing returns at higher vision levels
4. Realistic measurement variability</p>
</div>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../PROJECT_OVERVIEW.html" class="btn btn-neutral float-left" title="Macular Degeneration Treatment Simulation Project" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../analysis/index.html" class="btn btn-neutral float-right" title="Analysis Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Rose.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>